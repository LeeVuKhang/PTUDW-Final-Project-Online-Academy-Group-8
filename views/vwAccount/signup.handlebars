{{#fill_section 'js'}}
<script>
      function handleSubmit(event) {
      event.preventDefault(); 
      
      const username = document.querySelector('#txtUsername').value;
      if (username.length === 0) {
        alert('Please enter a username');
        return;
      }
      if (username.length < 3) {
        alert('Username must be at least 3 characters long');
        return;
      }

      fetch(`/account/is-available?username=${username}`)
      .then(function(res){
        return res.json();
      })
      .then(function(data){
        if (data === false){
          alert('Username is not available. Please choose another one');
          return;
        }
        event.target.submit(); 
      })
      {{!-- .then(function (err){
        console.log(err);
        alert('An error occurred. Please try again');
      }) --}}
    }
    document.querySelector('#frmRegister').addEventListener('submit', handleSubmit);
  </script>
{{/fill_section}}

<div class="card">
        <h5 class="card-header">Account registration</h5>
        <div class="card-body">
            <form method = "post" action = "/account/signup" id="frmRegister">
            <div class="mb-3">
                <label for="txtUsername" class="form-label">Username</label>
                <input type="text" class="form-control" id="txtUsername" name = "username" required>
            </div>
            <div class="mb-3">
                <label for="txtPassword" class="form-label">Password</label>
                <input type="password" class="form-control" id="txtPassword"  name = "password" required>
            </div>
            <div class="mb-3">
                <label for="txtConfirm" class="form-label">Confirm</label>
                <input type="password" class="form-control" id="txtConfirm"  name = "confirm" required>
            </div>
          </div>
          <div class="card-body">
            <h5>Information</h5>
            <div class="mb-3">
                <label for="txtName" class="form-label">Name</label>
                <input type="text" class="form-control" id="txtName"  name = "name" required>
            </div>
            <div class="mb-3">
                <label for="TxtEmail" class="form-label">Email address</label>
                <input type="email" class="form-control" id="txtEmail" aria-describedby="emailHelp" name = "email" required>
                <div id="emailHelp" class="form-text">We'll never share your email with anyone else.(nah we will)</div>
            </div>
            <div class="mb-3">
                <label for="txtdob" class="form-label">Day of Birth</label>
                <input type="date" class="form-control" id="txtdob"  name = "dob" required>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-patch-check"></i> Register
            </button>
        </div>
        </form>
        </div>

